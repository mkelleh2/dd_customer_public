{"data":{"type":"notebooks","attributes":{"metadata":{"type":"runbook"},"name":"[Implementation Services] Log Configuration Check","time":{"live_span":"1h"},"cells":[{"id":"nrd1nqga","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Log Configuration Checklist\n- [ ] All logs have _version_ tags\n- [ ] All logs have _service_ tags\n- [ ] All logs have _env_ tags\n- [ ] All indexed logs parsed\n- [ ] Ingested logs are reviewed and filtered as needed\n- [ ] There are no truncated logs\n- [ ] Multi-line is handled\n- [ ] Custom facets created\n- [ ] (Optional) Archive is set\n- [ ] (Optional) Relevant metrics from logs created\n- [ ] Estimated Log Usage Dashboard populating as expected\n- [ ] (Optional) Indexes with different retention times are implemented\n- [ ] (Optional) At least 1 exclusion filter per index\n- [ ] Log Search page showing desired logs\n- [ ] (After ~2 weeks of data) Log Anomaly Watchdog Insights are being generated"}}},{"id":"qazqha7s","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## All logs have _version_ tags\n\n**Status:** Not Started\n\n**Recommendation:** Implement `version` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/)."}}},{"id":"cch45958","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"response_format":"scalar","queries":[{"name":"a","data_source":"logs","compute":{"aggregation":"count"},"search":{"query":"-version:*"},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"should_exclude_missing":true,"sort":{"aggregation":"count","order":"desc"}}],"storage":"hot"}],"formulas":[{"formula":"a"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"time":{"live_span":"15m"}}},{"id":"3ml6fwmd","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## All logs have _service_ tags\n\n**Status:** Not Started\n\n**Recommendation:** Implement `service` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/).\n\n_Note: The tracer always adds `resource`, `name`, and `service` tags to spans. Datadog recommends never adding these as host level tags in the core Datadog agent config file to avoid confusion. You should set service at the Datadog agent integration config file._\n"}}},{"id":"00m788vf","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"response_format":"scalar","queries":[{"name":"a","data_source":"logs","search":{"query":"-service:*"},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"a"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"time":null,"graph_size":"m"}},{"id":"vq8bktww","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## All logs have _env_ tags\n\n**Status:** Not Started\n\n**Recommendation:** Implement `env` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/)."}}},{"id":"i8aogoxh","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"response_format":"scalar","queries":[{"name":"a","data_source":"logs","search":{"query":"-env:*"},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"a"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"time":null,"graph_size":"m"}},{"id":"50x1yeoq","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## All indexed logs are parsed\n\n**Status:** Not Started\n\n**Recommendation:** Create log pipelines for the log sources in the notebook list. Each of the log sources below will need a pipeline to standardize and parse out critical attributes from the message body. Check to see if there is an OOTB pipeline for an integration before creating a new one."}}},{"id":"twvysnls","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"name":"a","data_source":"logs","search":{"query":"datadog.pipelines:false"},"indexes":["*"],"group_by":[{"facet":"source","limit":250,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","sort":{"count":250,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","formula":"a"}]}],"has_search_bar":"auto"},"time":{"live_span":"15m"},"graph_size":"m"}},{"id":"sf4urhvb","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Ingested logs are reviewed and filtered as needed\n\n**Status:** Not Started\n\n**Recommendation:** If you are seeing a spike in on-demand costs for log ingestion, we recommend filtering out the logs before ingestion that are not required for any observability use case (ie. info) to keep ingestion costs low. The **Ingested logs per service** widget can help you prioritize what service should be reviewed first. Logs are filtered at the agent level using the [exclude_at_match](https://docs.datadoghq.com/agent/logs/advanced_log_collection/?tab=configurationfile#filter-logs) parameter."}}},{"id":"8dxb9r8o","type":"notebook_cells","attributes":{"definition":{"title":"Ingested logs (Month to date comparison to 4 weeks before)","type":"change","requests":[{"increase_good":true,"order_by":"change","change_type":"absolute","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"month_before(query1)"},{"formula":"query1"}],"queries":[{"query":"sum:datadog.estimated_usage.logs.ingested_events{*} by {service}.as_count()","data_source":"metrics","name":"query1","aggregator":"avg"}]}]},"time":{"start":"2025-01-01T17:32:47.000Z","end":"2025-01-14T17:32:47.000Z","live":true},"graph_size":"xs"}},{"id":"w69vxwub","type":"notebook_cells","attributes":{"definition":{"title":"Ingested logs per service","type":"toplist","requests":[{"response_format":"scalar","queries":[{"query":"sum:datadog.estimated_usage.logs.ingested_events{*} by {service}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}],"formulas":[{"formula":"query1"}],"sort":{"count":50,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"custom_links":[]},"time":null,"graph_size":"m"}},{"id":"5h8hmeuj","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## There are no truncated logs\n\n**Status:** Not Started\n\n**Recommendation:** Logs above 1MB are truncated. You can check which `service` and `source` are impacted with the `datadog.estimated_usage.logs.truncated_count` and `datadog.estimated_usage.logs.truncated_bytes` metrics. ([source](https://docs.datadoghq.com/logs/guide/log-collection-troubleshooting-guide/?tab=linux#truncated-logs)). Truncated logs will need to be fixed at the log source prior to ingestion into Datadog."}}},{"id":"x5yutd8r","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"events_query_1","data_source":"logs","search":{"query":"message:...TRUNCATED..."},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"formulas":[{"formula":"events_query_1"}]}]},"time":{"live_span":"15m"},"graph_size":"m"}},{"id":"97qsj5qk","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Multi-Line is handled\n\n**Status:** Not Started\n\n**Recommendation:** If it appears that most of the top 10 log patterns contain log patterns don't start with a date pattern, you may be experiencing a multi-line log issue and the agent configuration needs to be updated. More info on how to fix this issue can be found [here](https://docs.datadoghq.com/agent/logs/advanced_log_collection/?tab=configurationfile#automatic-multi-line-aggregation)."}}},{"id":"fx5fr1as","type":"notebook_cells","attributes":{"definition":{"requests":[{"response_format":"event_list","query":{"data_source":"logs_pattern_stream","query_string":"datadog.pipelines:false","indexes":[],"group_by":[{"facet":"status"},{"facet":"service"}],"clustering_pattern_field_path":"message"},"columns":[{"field":"status_line","width":"auto"},{"field":"matches","width":"auto"},{"field":"volume","width":"auto"},{"field":"status","width":"auto"},{"field":"service","width":"auto"},{"field":"message","width":"auto"}]}],"type":"list_stream"},"time":{"live_span":"15m"}}},{"id":"36za722g","type":"notebook_cells","attributes":{"definition":{"type":"change","requests":[{"increase_good":false,"order_by":"change","change_type":"relative","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"query2"},{"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"datadog.pipelines:false"},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"}}],"compute":{"aggregation":"count"},"storage":"hot"},{"name":"query2","data_source":"logs","search":{"query":""},"indexes":["*"],"group_by":[{"facet":"source","limit":10,"sort":{"aggregation":"count","order":"desc"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}]}]},"time":{"live_span":"1w"},"graph_size":"m"}},{"id":"zh3egzxp","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Custom facets created\n\n**Status:** Not Started\n\n**Recommendation:** Follow the directions [here](https://docs.datadoghq.com/logs/explorer/facets/) to create necessary custom facets in the Log Search page."}}},{"id":"94qypv8z","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## (Optional) Archive is set\n\n**Status:** Not Started\n\n**Recommendation:** Follow the directions [here](https://docs.datadoghq.com/logs/log_configuration/archives/?tab=awss3#format-of-the-archives) to create log archives as necessary."}}},{"id":"9qtpochr","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## (Optional) Relevant metrics from logs created\n\n**Status:** Not Started\n\n**Recommendation:** Follow the directions [here](https://docs.datadoghq.com/logs/log_configuration/logs_to_metrics/#logs-usage-metrics) to create log-based metrics as necessary for any low-cardinality, high-volume logs that you want to observe something from but don't want to pay a higher price in indexing."}}},{"id":"gb321mhr","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Estimated Log Usage Dashboard populating as expected\n\n**Status:** Not Started\n\n**Recommendation:** This dashboard is useful for understanding your ingestion and indexing for all logs. The dashboard will begin to populate as soon as logs are ingested into the platform. If no logs are seen, check the log configuration of the log source."}}},{"id":"o05erzbe","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## (Optional) Indexes with different retention times are implemented\n\n**Status:** Not Started\n\n**Recommendation:** Indexes are located on the [Configuration page](https://us3.datadoghq.com/logs/pipelines/) in the Indexes section. Review our extensive guide on Log Index recommendations, found [here](https://www.datadoghq.com/architecture/a-guide-to-log-management-indexing-strategies-with-datadog/)."}}},{"id":"xur1xnwo","type":"notebook_cells","attributes":{"definition":{"title":"Indexed logs by status last month","requests":[{"response_format":"scalar","queries":[{"data_source":"logs","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"status","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":""},"storage":"hot"}],"style":{"palette":"datadog16"},"formulas":[{"formula":"query1"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"}},"time":null,"graph_size":"m"}},{"id":"swmy74ps","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## (Optional) At least 1 exclusion filter per index\n\n**Status:** Not Started\n\n**Recommendation:** Create [exclusion filters](https://docs.datadoghq.com/logs/log_configuration/indexes/#exclusion-filters) in each index to reduce logs of limited usefulness (ie. debug, info) that are not needed for more than an hour in Datadog Live Search."}}},{"id":"iprop7de","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Log search showing desired logs\n\n**Status:** Not Started\n\n**Recommendation:** Use [this guide](https://docs.datadoghq.com/logs/guide/log-collection-troubleshooting-guide/?tab=linux) for Log Troubleshooting if you are not seeing the logs you expect. Follow up by filing a support ticket if the troubleshooting recommendations do not solve the issue."}}},{"id":"zkkmi8dg","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Watchdog Log Anomaly Alerts\nAlerts will populate the widget below if any have been generated in the past week. Note: Datadog needs two weeks of consecutive logs being ingested into the platform to begin generating Log Anomaly alerts."}}},{"id":"tninru83","type":"notebook_cells","attributes":{"definition":{"requests":[{"columns":[],"response_format":"event_list","query":{"data_source":"watchdog_alerts","query_string":"story_category:logs"}}],"type":"list_stream"},"time":{"live_span":"1w"},"graph_size":"m"}}],"template_variables":[],"schema_version":0}}}
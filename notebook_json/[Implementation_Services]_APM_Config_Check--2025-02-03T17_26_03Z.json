{"data":{"type":"notebooks","attributes":{"metadata":{"type":"runbook"},"name":"[Implementation Services] APM Config Check","time":{"live_span":"1h"},"cells":[{"id":"kl9wffya","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"# APM Configuration Checklist\n- [ ] service tags are implemented\n- [ ] version tags are implemented\n- [ ] env tags are implemented\n- [ ] (If applicable) correlation is configured \n- [ ] Monitors are set up for each service\n- [ ] Service Catalog & service map show correct service and dependency names\n- [ ] Traces being ingested and populating the Trace Search View\n- [ ] Service Catalog creating appropriate Service Overview pages\n- [ ] Check for missing instrumentation (ie. missing service on service map, service catalog, etc)\n- [ ] Intelligent retention filter is set up (OOTB) and reviewed \n- [ ] Ownership in Service Catalog is configured\n- [ ] Ingestion considerations have been defined based on what is critical to their business\n- [ ] Confirm creation of business metrics from manual instrumentation of tracing library                                                  \n- [ ] Custom spans have been generated \n- [ ] Retention filters are configured in order to Index a percentage of ingested spans to get detailed analysis of application performance"}}},{"id":"4nroq78g","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Service tags are implemented\n\n**Status:** Not Started\n\n**Recommendation:** Implement `service` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/)."}}},{"id":"gi6y143j","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"spans","search":{"query":"-service:*"},"indexes":["*"],"group_by":[{"facet":"service","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"time":null,"graph_size":"m"}},{"id":"n2p55r02","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## version tags are implemented\n\n**Status:** Not Started\n\n**Recommendation:** Implement `version` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/)."}}},{"id":"3g1lrsyx","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"spans","search":{"query":"-version:*"},"indexes":["*"],"group_by":[{"facet":"service","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"time":null,"graph_size":"m"}},{"id":"ete8v88t","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## env tags are implemented\n\n**Status:** Not Started\n\n**Recommendation:** Implement `env` tag using [this guide](https://docs.datadoghq.com/getting_started/tagging/)."}}},{"id":"pqnfkjii","type":"notebook_cells","attributes":{"definition":{"type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"spans","search":{"query":"-env:*"},"indexes":["*"],"group_by":[{"facet":"service","limit":10,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"time":null,"graph_size":"m"}},{"id":"m2n1ll9r","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Correlation is configured\n\n**Status:** Not Started\n\nBest way to check this is to go into a few traces and see what tabs are populating for a variety of services.\n\n**Recommendation:** You're tags are good to go, but still not seeing the correlation you expect across the products you purchased? Your setup may require additional configuration.\n\n1. [Correlate Logs and Traces](https://docs.datadoghq.com/tracing/other_telemetry/connect_logs_and_traces/)\n2. [Correlate Database Monitoring and Traces](https://docs.datadoghq.com/database_monitoring/connect_dbm_and_apm/?tab=go)\n3. [Connect RUM and Traces](https://docs.datadoghq.com/real_user_monitoring/platform/connect_rum_and_traces/?tab=browserrum)\n4. [Correlate Synthetics and Traces](https://docs.datadoghq.com/tracing/other_telemetry/synthetics/?tab=datadog)\n5. [Correlate profiles and Traces](https://docs.datadoghq.com/profiler/connect_traces_and_profiles/)"}}},{"id":"71l2la3l","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Monitors are set up for each service\n\n**Status:** Not Started\n\n**Recommendation:** At a minimum, set up the [recommended APM monitors](monitors/recommended?q=APM&only_installed=true&p=1) in the Monitor Template page. Additionally, the [APM Monitor type](https://docs.datadoghq.com/monitors/create/types/apm/?tab=apmmetrics) can be useful for generating APM related alerts."}}},{"id":"802ata8a","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"data_source":"events","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"service","limit":250,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"source:alert"}}],"response_format":"scalar","sort":{"count":250,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Total Alert Events","formula":"query1"}]}],"has_search_bar":"auto"},"time":null,"graph_size":"l"}},{"id":"ke1jufot","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Service Catalog & service map show correct service and dependency names\n\n**Status:** Not Started\n\nCheck the [service catalog](services?env=dev&fromUser=false&hostGroup=%2A&start=1738088212092&end=1738091812092) and [service map](/services?env=dev&fromUser=false&hostGroup=%2A&view=map&start=1738088210168&end=1738091810168) pages manually.\n\n**Recommendation:** If you are not seeing the expected connections in the service map, first check to see if this is an active service. Otherwise, you may need to modify your [APM configuration](https://docs.datadoghq.com/tracing/trace_collection/). If one service is showing up as multiple services in the map or catalog, this can happen when the service name is not consistent across all spans. See [this page](https://docs.datadoghq.com/tracing/troubleshooting/?tab=java#:~:text=This%20can%20happen%20when%20the%20service%20name%20is%20not%20consistent%20across%20all%20spans.) for more details."}}},{"id":"qqm6pqa2","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Traces being ingested and populating the Trace Search View\n\n**Status:** Not Started\n\nCheck the [trace search](/apm/traces?query=%40_trace_root%3A1&agg_m_a=count&agg_m_source_a=base&agg_t_a=count&cols=service%2Cresource_name%2C%40duration%2C%40http.method%2C%40http.status_code%2C%40_duration.by_service&colsTraces=service%2Cresource_name%2C%40duration%2C%40_span.count%2C%40_duration.by_service&fromUser=false&historicalData=true&query_a=%40_trace_root%3A1&query_translation_version=v0&spanType=trace-root&storage=hot&target-span=a&traceQuery=a&view=traces&viz=stream&start=1738091009546&end=1738091909546&paused=false) page and filter by the service name (ie. service:web-store) for which you enabled APM.\n\n**Recommendation:** Review the [data volume guidelines](https://docs.datadoghq.com/tracing/troubleshooting/?tab=java#data-volume-guidelines) if you feel you are missing spans/traces. If no traces are being sent, it may be a [connection error](https://docs.datadoghq.com/tracing/troubleshooting/?tab=java#connection-errors). This section on [debugging and logging](https://docs.datadoghq.com/tracing/troubleshooting/?tab=java#debugging-and-logging) in APM may also be useful."}}},{"id":"9qqmyazf","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Service Catalog creating appropriate Service Overview pages\n\n**Status:** Not Started\n\nIn the Service Catalog, hover over a service and select the **Service Page** button.\n\n**Recommendation:** The service pages are OOTB pages that should automatically generated once you setup APM. If you are missing expected correlation from other products on these pages, it's likely a tag issue. Otherwise, see these pages on correlation:\n1. [Correlate Logs and Traces](https://docs.datadoghq.com/tracing/other_telemetry/connect_logs_and_traces/)\n2. [Correlate Database Monitoring and Traces](https://docs.datadoghq.com/database_monitoring/connect_dbm_and_apm/?tab=go)\n3. [Connect RUM and Traces](https://docs.datadoghq.com/real_user_monitoring/platform/connect_rum_and_traces/?tab=browserrum)\n4. [Correlate Synthetics and Traces](https://docs.datadoghq.com/tracing/other_telemetry/synthetics/?tab=datadog)\n5. [Correlate profiles and Traces](https://docs.datadoghq.com/profiler/connect_traces_and_profiles/)"}}},{"id":"n2wyqtho","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Check for missing instrumentation (ie. missing service on service map, service catalog, etc)\n\n**Status:** Not Started\n\n**Recommendation:** Check the [service catalog](https://app.datadoghq.com/notebook/11217412/services?env=dev\\&fromUser=false\\&hostGroup=%2A\\&start=1738088212092\\&end=1738091812092) and [service map](https://app.datadoghq.com/services?env=dev\\&fromUser=false\\&hostGroup=%2A\\&view=map\\&start=1738088210168\\&end=1738091810168) pages manually."}}},{"id":"aeddkgp9","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Intelligent retention filter is set up (OOTB) and reviewed\n\n**Status:** Not Started\n\n**Recommendation:** Click [here](/apm/traces/retention-filters?fromUser=false&start=1738088732142&end=1738092332142&paused=false) to navigate to the APM Retention Filters page. The [Intelligent Retention Filter](https://docs.datadoghq.com/tracing/trace_pipeline/trace_retention/#datadog-intelligent-retention-filter) retains spans for every environment, service, operation, and resource for different latency distributions. "}}},{"id":"b6b5mazu","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Ownership in Service Catalog is configured\n\n**Status:** Not Started\n\n**Recommendation:** Check [here](/services?env=dev&fromUser=false&hostGroup=%2A&lens=Ownership&start=1738088873102&end=1738092473102) to see if Ownership is configured.\n\nDatadog Service Catalog is pre-populated with entries detected through [APM](https://docs.datadoghq.com/tracing/), eBPF-based autodiscovery with [Universal Service Monitoring](https://docs.datadoghq.com/universal_service_monitoring/), and RUM applications. Additional metadata will need to be uploaded via the [Datadog UI](/services/settings/get-started?fromUser=false&start=1738088873251&end=1738092473251) or [Datadog API](https://docs.datadoghq.com/api/latest/service-definition/) to populate the Ownership tab. Sample schema can be found [here](https://docs.datadoghq.com/service_catalog/customize#enrich-auto-detected-services-with-metadata)."}}},{"id":"wwd4px2e","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Ingestion considerations have been defined based on what is critical to their business.\n\n**Status:** Not Started\n\n**Recommendation:**\n\n"}}},{"id":"kd2pj0d9","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.apm.ingested_bytes{*} by {service}.as_count()","aggregator":"max"}],"response_format":"scalar","sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Ingested Bytes (Month to Date)","formula":"query1"}]}],"has_search_bar":"auto"},"time":{"start":"2025-01-01T08:00:00.000Z","end":"2025-01-29T18:45:30.000Z","live":true},"graph_size":"m"}},{"id":"he9crh4b","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.apm.ingested_bytes_by_host{*} by {host}.as_count()","aggregator":"max"}],"response_format":"scalar","sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Ingested Bytes (Month to Date)","formula":"query1"}]}],"has_search_bar":"auto"},"time":null,"graph_size":"m"}},{"id":"w9choufl","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Confirm creation of business metrics from manual instrumentation of tracing library\n\n**Status:** Not Started\n\n**Recommendation:** Consider using [custom instrumentation](https://docs.datadoghq.com/tracing/trace_collection/custom_instrumentation/?tab=datadogapi) to:\n1. Add custom span tags to traces (ie. customer id, customer_tier, cart_value, etc).\n2. Customize an error associated with one of your spans.\n3. Set tags and errors on a root span from a child span - When an event or condition happens downstream, you may want that behavior or value reflected as a tag on the top level or root span. This can be useful to count an error or for measuring performance, or setting a dynamic tag for observability.\n4. Extend tracers for custom post-processors.\netc."}}},{"id":"1pwkmmyb","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Custom spans have been generated\n\n**Status:** Not Started\n\n**Recommendation:** Consider generating [custom metrics generated from spans](https://docs.datadoghq.com/tracing/trace_pipeline/generate_metrics/) for important endpoints or other low-cardinality groups.\n\n| Reason                                             | Custom Metrics Generated from Spans                                                                                  | Retention Filters                                                                                                                                                                                                              |\n| -------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |\n| Retention Period                                   | 15 months                                                                                                            | 15 days                                                                                                                                                                                                                        |\n| Anomaly Detection                                  | Create an [Anomaly Monitor](https://docs.datadoghq.com/monitors/types/anomaly/#overview) based on generated metrics. | Use Analytics to compare behavior over the past 15 days, and view complete traces to investigate root cause.                                                                                                                   |\n| Investigation of matching traces with full context | N/A - Custom Metrics do not result in any retention of associated traces.                                            | Keep exactly the traces relevant to your business context with [retention filters](https://docs.datadoghq.com/tracing/trace_pipeline/trace_retention).                                                                         |\n| Granularity of behavior                            | Create custom metrics for important endpoints or other low-cardinality groups.                                       | Use [Trace Explorer](https://docs.datadoghq.com/tracing/trace_explorer/) for specific endpoints, or use the ‘Group By’ option in [Analytics](https://docs.datadoghq.com/tracing/trace_explorer/query_syntax/#analytics-query). |\n| Forecasting or complex mathematics                 | Create a [Forecast monitor](https://docs.datadoghq.com/monitors/types/forecasts/) based on generated metrics.        | N/A                                                                                                                                                                                                                            |"}}},{"id":"74jd8pek","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"## Retention filters are configured in order to Index a percentage of ingested spans to get detailed analysis of application performance\n\n**Status:** Not Started\n\n**Recommendation:**"}}},{"id":"y24mefda","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.apm.ingested_spans{*} by {service}.as_count()","aggregator":"max"}],"response_format":"scalar","sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Ingested Spans (Month to Date)","formula":"query1"}]}],"has_search_bar":"auto"},"time":null,"graph_size":"m"}},{"id":"edz5r0dg","type":"notebook_cells","attributes":{"definition":{"type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:datadog.estimated_usage.apm.ingested_spans_by_host{*} by {host}.as_count()","aggregator":"max"}],"response_format":"scalar","sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Ingested Spans (Month to Date)","formula":"query1"}]}],"has_search_bar":"auto"},"time":null,"graph_size":"m"}},{"id":"awsvb5sr","type":"notebook_cells","attributes":{"definition":{"type":"markdown","text":"---\n## Additional Resources\n- [Inferred Services](https://docs.datadoghq.com/tracing/services/inferred_services/?tab=agentv7551)\n- [Remove Service Overrides](https://docs.datadoghq.com/tracing/guide/service_overrides/#remove-service-overrides)\n- [Add a secondary primary tag](https://docs.datadoghq.com/tracing/guide/setting_primary_tags_to_scope/?tab=helm#add-a-second-primary-tag-in-datadog:~:text=the%20current%20page.-,Add%20a%20second%20primary%20tag%20in%20Datadog,-If%20you%20need) - Useful for being able to break down the service catalog groupings to something other than env.\n- [Retention Filters](https://docs.datadoghq.com/tracing/trace_pipeline/trace_retention/#retention-filters)\n  - ** Trace analytics monitors **exclude** spans from the intelligent retention filter ([source](https://docs.datadoghq.com/tracing/trace_pipeline/trace_retention/#datadog-intelligent-retention-filter:~:text=For%20the%20reasons%20explained%20above%2C%20spans%20indexed%20by%20the%20intelligent%20retention%20filter%20are%20excluded%20from%20APM%20trace%20analytics%20monitor%20evaluation.)). You may need to create a retention filter for services you want to monitor. \n- [Usage Metrics](https://docs.datadoghq.com/tracing/trace_pipeline/metrics/)"}}}],"template_variables":[],"schema_version":0}}}